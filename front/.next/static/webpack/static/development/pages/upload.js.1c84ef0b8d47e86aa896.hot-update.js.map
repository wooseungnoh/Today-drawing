{"version":3,"file":"static/webpack/static\\development\\pages\\upload.js.1c84ef0b8d47e86aa896.hot-update.js","sources":["webpack:///./pages/upload.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport Router from 'next/Router';\r\nimport Container from '../components/container';\r\nimport { Input, Form, Textarea } from '../components/uiComponent';\r\nimport {\r\n  UPPLOAD_CANVAS_REQUEST,\r\n  DELETE_PHOTO,\r\n  UPPLOAD_POST_REQUEST,\r\n  UPPLOADING_DONE,\r\n} from '../reducers/drawing';\r\nimport { useInput } from './login';\r\n\r\nconst Upload = () => {\r\n  const { imagePaths, isUploadingPost } = useSelector((state) => state.drawing);\r\n  const { isLoggedIn } = useSelector((state) => state.user);\r\n  const [title, setTitle] = useInput('');\r\n  const [description, setDescription] = useInput('');\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    if (!isLoggedIn) {\r\n      Router.push('/');\r\n    }\r\n  }, [isLoggedIn]);\r\n\r\n  const addPhoto = (e) => {\r\n    e.preventDefault();\r\n    if (isLoggedIn) {\r\n      dispatch({\r\n        type: UPPLOAD_POST_REQUEST,\r\n        data: { title, description, imagePaths },\r\n      });\r\n    }else{\r\n      alert('작성 권한이 없습니다. 로그인페이지로 이동합니다.')\r\n      Router.push('/')\r\n    }\r\n  };\r\n\r\n  const handlePhotoFile = (e) => {\r\n    const imageFormData = new FormData();\r\n    [].forEach.call(e.target.files, (f) => {\r\n      imageFormData.append('photo', f);\r\n    });\r\n    dispatch({\r\n      type: UPPLOAD_CANVAS_REQUEST,\r\n      data: imageFormData,\r\n    });\r\n  };\r\n\r\n  const handleDeleteImage = () => {\r\n    dispatch({\r\n      type: DELETE_PHOTO,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isUploadingPost) {\r\n      handleDeleteImage();\r\n      dispatch({\r\n        type: UPPLOADING_DONE,\r\n      });\r\n      Router.push('/gallery');\r\n    }\r\n  }, [isUploadingPost]);\r\n\r\n  return (\r\n    <Container flexDirection=\"column\">\r\n      <div\r\n        style={{\r\n          minHeight: '200px',\r\n          display: 'flex',\r\n          justifyContent: 'center',\r\n          alignItems: 'center',\r\n          width: '300px',\r\n        }}\r\n      >\r\n        {imagePaths[0] ? (\r\n          <div style={{ position: 'relative' }}>\r\n            <img\r\n              src={`http://localhost:5000/${imagePaths[0]}`}\r\n              style={{ width: '100%' }}\r\n              alt={imagePaths[0]}\r\n            />\r\n            <button\r\n              onClick={handleDeleteImage}\r\n              style={{ position: 'absolute', top: '5px', right: '5px' }}\r\n            >\r\n              X\r\n            </button>\r\n          </div>\r\n        ) : (\r\n          <span>미리보기 이미지</span>\r\n        )}\r\n      </div>\r\n\r\n      <Form onSubmit={addPhoto} encType=\"multipart/form-data\">\r\n        <label htmlFor=\"file\">파일 선택</label>\r\n        <Input\r\n          type=\"file\"\r\n          name=\"photo\"\r\n          onChange={handlePhotoFile}\r\n          accept=\"image/*\"\r\n        />\r\n\r\n        <label>그림 제목</label>\r\n        <Input value={title} onChange={setTitle} type=\"text\" />\r\n\r\n        <label>그림 설명</label>\r\n        <Textarea value={description} onChange={setDescription} />\r\n        <Input type=\"submit\" value=\"작성\" />\r\n      </Form>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Upload;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAMA;AACA;AACA;AAAA;AACA;AAAA;AADA;AAAA;AACA;AADA;AAEA;AAAA;AAFA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAIA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AALA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;;;;A","sourceRoot":""}